# LicheePi4A（RISC-V 架构）平台 RuyiSDK 配置及 Luanti 游戏编译运行测试报告

[TOC]

## 基础信息

- 硬件平台：LicheePi4A（RISC-V 架构）

- 系统环境：RevyOS 嵌入式 RISC-V 发行版

- 开发工具：RuyiSDK（gnu-plct-xthead 工具链）

- 测试目的：验证 RuyiSDK 在 LicheePi4A 本机环境的安装、配置有效性，以及Luanti游戏的编译、运行可行性



## 测试步骤与结果

| 序号 | 输入及操作说明                                               | 期望测试结果 |
| ---- | ------------------------------------------------------------ | ------------ |
| 1    | 安装 RuyiSDK 包管理器<br/>`wget https://mirror.iscas.ac.cn/ruyisdk/ruyi/tags/0.44.0/ruyi-0.44.0.riscv64`<br/>`chmod +x ./ruyi-0.44.0.riscv64`<br/>`sudo cp -v ./ruyi-0.44.0.riscv64 /usr/local/bin/ruyi` | 成功安装     |
| 2    | 获取远程软件源的内容并刷新本地软件包缓存<br/>`ruyi update`   | 成功获取     |
| 3    | 安装 gnu 工具链<br/>`ruyi install gnu-plct-xthead`           | 成功安装     |
| 4    | 创建并激活 ruyi 虚拟环境<br/>`ruyi venv -t gnu-plct-xthead sipeed-lpi4a ./venv-plct-luanti`<br/>`. venv-plct-luanti/bin/ruyi-activate` | 成功安装     |
| 5    | 查看当前环境下的 gcc 是否可用<br/>`riscv64-plctxthead-linux-gnu-gcc --version` | 成功运行     |
| 6    | 更新系统软件包列表，确保获取最新的包信息<br/>`sudo apt update` | 成功更新     |
| 7    | 安装基础编译工具（g++/make/cmake/git）和 C 标准库开发文件<br/>`sudo apt install g++ make libc6-dev cmake git` | 成功安装     |
| 8    | 安装各类依赖库<br/>`sudo apt install libpng-dev libjpeg-dev libsqlite3-dev libogg-dev libvorbis-dev libopenal-dev libcurl4-gnutls-dev zlib1g-dev libgmp-dev libjsoncpp-dev libzstd-dev libluajit-5.1-dev gettext libgles2-mesa-dev libsdl2-dev libgles2-mesa-dev libsdl2-dev` | 成功安装     |
| 9    | 配置 GitHub 加速<br/>`printf '140.82.121.3 github.com\n185.199.108.153 assets-cdn.github.com\n' |sudo tee -a /etc/hosts > /dev/null`<br/>`sudo /etc/init.d/networking restart` | 成功配置     |
| 10   | 安装 GL4ES<br/>`git clone https://github.com/ptitSeb/gl4es`  | 成功安装     |
| 11   | 进入 GL4ES 源码目录并创建编译输出目录<br/>`mkdir build`<br/>`cd build` | 成功建立     |
| 12   | 运行 CMake 配置编译参数并进行多线程编译<br/>`cmake .. -DCMAKE_BUILD_TYPE=RelWithDebInfo \<br/>-DCMAKE_C_COMPILER=riscv64-plctxthead-linux-gnu-gcc \<br/>-DNOX11=ON \<br/>-DFB=ON`<br/>`make -j$(nproc)` | 成功运行     |
| 13   | 获取 Luanti 项目源码<br/>`git clone --depth 1 https://github.com/luanti-org/luanti` | 成功获取     |
| 14   | 进入 git 克隆的 Luanti 源码目录<br/>`cd luanti`              | 成功进入     |
| 15   | 编译 Luanti 项目<br/>`mkdir build`<br/>`cd build`<br/>`cmake .. -DUSE_SDL2=ON -DENABLE_OPENGL=OFF -DENABLE_GLES2=ON -DRUN_IN_PLACE=TRUE -DENABLE_OPENGL3=OFF` | 成功编译     |
| 16   | 多线程编译 Luanti 项目<br/>`make -j$(nproc)`                 | 成功编译     |
| 17   | 创建启动脚本 run.sh<br/>`nano run.sh`<br/>`export LIBGL_FB=1`<br/>`export LIBGL_SHRINK=1`<br/>`export LIBGL_ES=2`<br/>`export LIBGL_GL=21`<br/>`export LIBGL_ALWAYS_SOFTWARE=1`<br/>`export LIBGL_EGL=1`<br/>`export LIBGL_NOVULKAN=1`<br/>`export LIBGL_NODRI=1`<br/>`export MESA_LOADER_DRIVER_OERRIDE=swrast`<br/>`export GALLIUM_DRIVER=softpipe`<br/>`export LD_LIBRARY_PATH="/home/debian/licheepi-new/gl4es/build/lib:$LD_LIBRARY_PATH"<br/>`/home/debian/licheepi-new/gl4es/build/luanti/bin/luanti` | 成功创建     |
| 18   | 启动游戏<br/>`./run.sh`                                      | 成功启动     |

##  问题汇总与分析

### 问题1：安装 qemu-user-riscv-upstream 提示无 linux/riscv64 二进制文件 

- 分析：在 Linux 系统上下载 QEMU 应采用别的方法，官网上的下载方法仅适用于 Windows 系统，错误详情请看附件 1



## 问题2：1、wget 请求的下载链接已经失效或不存在

- 分析：此处采用了sudo apt install qemu-system-riscv64 qemu-utils libvirt-clients  下载QEMU，但在下载RISC-V桌面发行版的时候出现了wget 请求的 下载链接已经失效或不存在了错误，错误详情请看附件2



## 附件1

![image-20260119125427748](C:\Users\DELL\Desktop\P118实习\图片\image-20260119125427748.png)



![image-20260119125453533](C:\Users\DELL\Desktop\P118实习\图片\image-20260119125453533.png)

## 附件2

![image-20260119125523269](C:\Users\DELL\Desktop\P118实习\图片\image-20260119125523269.png)
